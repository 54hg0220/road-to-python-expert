# å˜é‡ï¼ˆVariablesï¼‰
# å®šä¹‰æ–¹å¼ï¼šPython æ˜¯åŠ¨æ€ç±»åž‹è¯­è¨€ï¼Œä¸éœ€è¦å£°æ˜Žå˜é‡ç±»åž‹ã€‚
x = 10
name = "Alice"

# PEP 8 å‘½åè§„èŒƒï¼ˆNaming Conventionsï¼‰
# 1. å˜é‡å / å‡½æ•°å
# ä½¿ç”¨ å°å†™å­—æ¯ + ä¸‹åˆ’çº¿ï¼ˆsnake_caseï¼‰
user_name = "Alice"


def calculate_total():
    pass


# 2. ç±»å
# ä½¿ç”¨ é¦–å­—æ¯å¤§å†™çš„é©¼å³°å¼å‘½åï¼ˆCapWords / PascalCaseï¼‰
# ç¤ºä¾‹ï¼š
class UserProfile:
    pass


# 3. å¸¸é‡å
# ä½¿ç”¨ å…¨å¤§å†™å­—æ¯ + ä¸‹åˆ’çº¿
MAX_RETRIES = 5
PI = 3.14159

# 4. ç§æœ‰å˜é‡ / å‡½æ•°
# ä½¿ç”¨ å•ä¸‹åˆ’çº¿å‰ç¼€ è¡¨ç¤ºâ€œå†…éƒ¨ä½¿ç”¨â€
_internal_value = 42


def _helper_function():
    pass


# 5. å¼ºåˆ¶ç§æœ‰ï¼ˆä¸å»ºè®®ä½¿ç”¨ï¼‰
# ä½¿ç”¨ åŒä¸‹åˆ’çº¿å‰ç¼€ï¼Œä¼šè§¦å‘åç§°é‡æ•´ï¼ˆname manglingï¼‰
class MyClass:
    def __init__(self):
        self.__private_attr = 10


# 6. æ¨¡å—å / åŒ…å
# ä½¿ç”¨ å°å†™å­—æ¯ï¼Œå¯ä»¥åŒ…å«ä¸‹åˆ’çº¿

# ä¸å¯å˜å¯¹è±¡ç¤ºä¾‹ immutable
a = 10
b = a
a = a + 1
print(a, b)  # è¾“å‡º: 11 10ï¼ˆa å’Œ b æŒ‡å‘ä¸åŒçš„å¯¹è±¡ï¼‰

# å¯å˜å¯¹è±¡ç¤ºä¾‹ mutable
list1 = [1, 2, 3]
list2 = list1
list1.append(4)
print(list1, list2)  # è¾“å‡º: [1, 2, 3, 4] [1, 2, 3, 4]ï¼ˆlist2 ä¹Ÿè¢«ä¿®æ”¹äº†ï¼‰

# Python ä¸­å˜é‡æ˜¯å¦‚ä½•ç®¡ç†å†…å­˜çš„ï¼Ÿ
# 1. å˜é‡æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼ˆå¼•ç”¨è¯­ä¹‰ï¼‰
a = [1, 2, 3]
b = a  # b å’Œ a æŒ‡å‘åŒä¸€ä¸ªåˆ—è¡¨å¯¹è±¡

# 2. å¯¹è±¡çš„å†…å­˜ç»“æž„
# æ¯ä¸ªå¯¹è±¡åœ¨å†…å­˜ä¸­éƒ½æœ‰ä»¥ä¸‹ç»„æˆï¼š
# ç±»åž‹ä¿¡æ¯ï¼ˆtypeï¼‰ï¼šå¯¹è±¡çš„ç±»åž‹ï¼ˆå¦‚ int, listï¼‰
# å¼•ç”¨è®¡æ•°ï¼ˆrefcountï¼‰ï¼šæœ‰å¤šå°‘å˜é‡å¼•ç”¨äº†è¿™ä¸ªå¯¹è±¡
# å€¼å†…å®¹ï¼ˆvalueï¼‰ï¼šå¯¹è±¡å®žé™…å­˜å‚¨çš„æ•°æ®

import sys

x = [1, 2, 3]
b = x
print(sys.getrefcount(x))  # é€šå¸¸ä¼šå¤šä¸€ä¸ªå¼•ç”¨ï¼Œå› ä¸º getrefcount() æœ¬èº«ä¹Ÿå¼•ç”¨äº† x

# 4. åžƒåœ¾å›žæ”¶æœºåˆ¶ï¼ˆGarbage Collectionï¼‰
# é™¤äº†å¼•ç”¨è®¡æ•°ï¼ŒPython è¿˜ä½¿ç”¨ åžƒåœ¾å›žæ”¶å™¨ï¼ˆGCï¼‰ æ¥å¤„ç† å¾ªçŽ¯å¼•ç”¨ çš„æƒ…å†µã€‚
# Python çš„ GC ä½¿ç”¨ åˆ†ä»£å›žæ”¶ç®—æ³•ï¼ˆGenerational GCï¼‰
# å¯¹è±¡è¢«åˆ†ä¸ºä¸‰ä»£ï¼ˆ0ã€1ã€2ï¼‰ï¼Œæ–°å¯¹è±¡åœ¨ç¬¬ 0 ä»£ï¼Œå­˜æ´»è¶Šä¹…è¶Šå¯èƒ½è¢«æå‡åˆ°æ›´é«˜ä»£
# ä½¿ç”¨ gc æ¨¡å—å¯ä»¥æ‰‹åŠ¨æŽ§åˆ¶åžƒåœ¾å›žæ”¶
# ðŸ§  ä¸ºä»€ä¹ˆéœ€è¦åžƒåœ¾å›žæ”¶ï¼Ÿ
# Python ä½¿ç”¨ å¼•ç”¨è®¡æ•°ï¼ˆReference Countingï¼‰ æ¥ç®¡ç†å†…å­˜ï¼šæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œè®°å½•æœ‰å¤šå°‘ä¸ªå˜é‡æˆ–å¯¹è±¡å¼•ç”¨å®ƒã€‚
#
# å½“å¼•ç”¨è®¡æ•°ä¸º 0 æ—¶ï¼Œå¯¹è±¡ä¼šè¢«ç«‹å³é”€æ¯ã€‚

import gc


class Node:
    def __init__(self, name):
        self.name = name
        self.partner = None

    def __del__(self):
        print(f"{self.name} è¢«é”€æ¯")


# åˆ›å»ºä¸¤ä¸ªå¯¹è±¡
a = Node("A")
b = Node("B")

# å½¢æˆå¾ªçŽ¯å¼•ç”¨
a.partner = b
b.partner = a

# åˆ é™¤å˜é‡å¼•ç”¨
del a
del b

# æ‰‹åŠ¨è§¦å‘åžƒåœ¾å›žæ”¶
print("å¼€å§‹åžƒåœ¾å›žæ”¶")
gc.collect()
print("åžƒåœ¾å›žæ”¶å®Œæˆ")

# 5. å°æ•´æ•°ç¼“å­˜æœºåˆ¶ï¼ˆInteger Cachingï¼‰
# Python ä¼šç¼“å­˜å¸¸ç”¨çš„å°æ•´æ•°ï¼ˆé€šå¸¸æ˜¯ -5 åˆ° 256ï¼‰å’ŒçŸ­å­—ç¬¦ä¸²ï¼Œä»¥æé«˜æ€§èƒ½ã€‚
a = 100
b = 100
print(a is b)  # Trueï¼Œå°æ•´æ•°ç¼“å­˜

x = 1000
y = 1000
# >>> x = 1000
# >>> y = 1000
# >>> x is y
# False
print(x is y)  # Falseï¼Œè¶…å‡ºç¼“å­˜èŒƒå›´
print(id(x), id(y))  # å®ƒä»¬å¯èƒ½åœ¨ç¼–è¯‘é˜¶æ®µå°±æŠŠ 1000 ä½œä¸ºå¸¸é‡æ± ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡å¤„ç†ã€‚

# âœ… æ€»ç»“ï¼šä»€ä¹ˆæ—¶å€™ä½ éœ€è¦å…³å¿ƒ is å’Œå¯¹è±¡å†…å­˜åœ°å€ï¼Ÿ
# åœºæ™¯	æ˜¯å¦éœ€è¦å…³å¿ƒ
# åˆ¤æ–­æ˜¯å¦ä¸º None	âœ… ä½¿ç”¨ is
# åˆ¤æ–­ä¸¤ä¸ªå˜é‡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡	âœ… ä½¿ç”¨ is
# åˆ¤æ–­ä¸¤ä¸ªå˜é‡å€¼æ˜¯å¦ç›¸ç­‰	âŒ ä½¿ç”¨ ==
# è°ƒè¯•å¯¹è±¡å¼•ç”¨é—®é¢˜	âœ… ä½¿ç”¨ id() å’Œ is
# å†™æ€§èƒ½æ•æ„Ÿä»£ç ï¼ˆç¼“å­˜ã€å•ä¾‹ï¼‰	âœ… å¯èƒ½éœ€è¦

# 6. å†…å­˜æ± æœºåˆ¶ï¼ˆMemory Poolï¼‰
# Pythonï¼ˆCPython å®žçŽ°ï¼‰ä½¿ç”¨ å†…å­˜æ± æœºåˆ¶ï¼ˆå¦‚ pymallocï¼‰ æ¥ä¼˜åŒ–å°å¯¹è±¡çš„å†…å­˜åˆ†é…ï¼Œå‡å°‘é¢‘ç¹çš„ç³»ç»Ÿè°ƒç”¨ã€‚
# ðŸ§  ä¸ºä»€ä¹ˆéœ€è¦å†…å­˜æ± æœºåˆ¶ï¼Ÿ
# åœ¨ Python ä¸­ï¼Œå¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯éžå¸¸é¢‘ç¹ï¼Œå°¤å…¶æ˜¯å°å¯¹è±¡ï¼ˆå¦‚æ•´æ•°ã€å­—ç¬¦ä¸²ã€åˆ—è¡¨ç­‰ï¼‰ã€‚å¦‚æžœæ¯æ¬¡éƒ½å‘æ“ä½œç³»ç»Ÿç”³è¯·å’Œé‡Šæ”¾å†…å­˜ï¼Œä¼šå¸¦æ¥ï¼š
#
# æ€§èƒ½å¼€é”€å¤§ï¼ˆç³»ç»Ÿè°ƒç”¨æ…¢ï¼‰
# å†…å­˜ç¢Žç‰‡åŒ–ä¸¥é‡
# ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒCPython å®žçŽ°äº†ä¸€ä¸ªé«˜æ•ˆçš„å†…å­˜ç®¡ç†æœºåˆ¶ â€”â€” pymalloc å†…å­˜æ± æœºåˆ¶ã€‚
# ðŸ§± pymalloc å†…å­˜æ± æœºåˆ¶ç®€ä»‹
# ðŸ“Œ æ ¸å¿ƒæ€æƒ³ï¼š
# å°†å°å¯¹è±¡çš„å†…å­˜åˆ†é…äº¤ç»™ Python è‡ªå·±ç®¡ç†ï¼Œè€Œä¸æ˜¯é¢‘ç¹è°ƒç”¨æ“ä½œç³»ç»Ÿçš„ malloc/freeã€‚
#
# ðŸ“¦ å†…å­˜åˆ†é…ç»“æž„ï¼š
# Arenaï¼ˆç«žæŠ€åœºï¼‰ï¼š2^20 å­—èŠ‚ï¼ˆ1MBï¼‰çš„å¤§å—å†…å­˜ï¼Œä»Žæ“ä½œç³»ç»Ÿç”³è¯·ã€‚
# Poolï¼ˆæ± ï¼‰ï¼šArena è¢«åˆ’åˆ†ä¸ºå¤šä¸ª Poolï¼Œæ¯ä¸ª Pool å¤§çº¦ 4KBã€‚
# Blockï¼ˆå—ï¼‰ï¼šPool è¢«åˆ’åˆ†ä¸ºå¤šä¸ª Blockï¼Œæ¯ä¸ª Block æ˜¯å®žé™…åˆ†é…ç»™å¯¹è±¡çš„å†…å­˜å•å…ƒã€‚
# ðŸ§© Block çš„å¤§å°ï¼š
# åªé€‚ç”¨äºŽ å°å¯¹è±¡ï¼ˆâ‰¤ 512 å­—èŠ‚ï¼‰
# Block å¤§å°ä»Ž 8 å­—èŠ‚åˆ° 512 å­—èŠ‚ä¸ç­‰ï¼ŒæŒ‰ 8 å­—èŠ‚å¯¹é½

# å½“ä½ å†™ä¸‹ï¼š
x = 42
# Python ä¼šä»Žå†…å­˜æ± ä¸­æ‰¾ä¸€ä¸ªå¤§å°åˆé€‚çš„ Blockï¼ˆæ¯”å¦‚ 16 å­—èŠ‚ï¼‰
# å¦‚æžœæ²¡æœ‰ï¼Œå°±ä»Ž Pool ä¸­åˆ†é…
# å¦‚æžœ Pool ä¹Ÿæ»¡äº†ï¼Œå°±ä»Ž Arena ä¸­åˆ†é…æ–°çš„ Pool
print(sys.getsizeof(10))  # å°æ•´æ•°
print(sys.getsizeof("ok"))  # å°å­—ç¬¦ä¸²
print(sys.getsizeof([]))  # ç©ºåˆ—è¡¨
print(sys.getsizeof([0] * 1000))  # å¤§å¯¹è±¡ï¼ˆå¯èƒ½è¶…è¿‡ 512 å­—èŠ‚ï¼‰
# ðŸ§  ä¸€ã€Python ä¸­â€œä¸€åˆ‡çš†å¯¹è±¡â€
# åœ¨ Python ä¸­ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ˜¯å¯¹è±¡ï¼ˆobjectï¼‰ï¼ŒåŒ…æ‹¬æ•´æ•°ã€å­—ç¬¦ä¸²ã€å‡½æ•°ã€ç±»ã€æ¨¡å—ç­‰ã€‚
#
# æ¯ä¸ªå¯¹è±¡åœ¨å†…å­˜ä¸­éƒ½æœ‰ä¸€ä¸ªç»“æž„ï¼Œé€šå¸¸åŒ…å«ï¼š
#
# ç»„æˆéƒ¨åˆ†	è¯´æ˜Ž
# ob_refcnt	å¼•ç”¨è®¡æ•°ï¼ˆç”¨äºŽå†…å­˜ç®¡ç†ï¼‰
# ob_type	å¯¹è±¡ç±»åž‹ï¼ˆå¦‚ intã€strï¼‰
# ob_size	å¯¹è±¡å¤§å°ï¼ˆå¦‚åˆ—è¡¨é•¿åº¦ï¼‰
# ob_data	å®žé™…æ•°æ®å†…å®¹

# ðŸ§± äºŒã€å†…å­˜åˆ†é…æœºåˆ¶
# 1. å°å¯¹è±¡ï¼ˆâ‰¤ 512 å­—èŠ‚ï¼‰
# ä½¿ç”¨ pymalloc å†…å­˜æ± æœºåˆ¶
# åˆ†é…è‡ªå®šä¹‰çš„å†…å­˜å—ï¼ˆBlockï¼‰æ¥æé«˜æ•ˆçŽ‡
# 2. å¤§å¯¹è±¡ï¼ˆ> 512 å­—èŠ‚ï¼‰
# ç›´æŽ¥è°ƒç”¨æ“ä½œç³»ç»Ÿçš„ malloc() åˆ†é…å†…å­˜
# ä¸èµ°å†…å­˜æ± æœºåˆ¶

# ðŸ” ä¸‰ã€å˜é‡ä¸Žå¯¹è±¡çš„å…³ç³»ï¼ˆå¼•ç”¨æ¨¡åž‹ï¼‰
x = [1, 2, 3]
# x æ˜¯ä¸€ä¸ªå˜é‡åï¼Œå­˜å‚¨åœ¨æ ˆï¼ˆstackï¼‰ä¸­
# [1, 2, 3] æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå­˜å‚¨åœ¨å †ï¼ˆheapï¼‰ä¸­
# x å®žé™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å †ä¸­çš„å¯¹è±¡

# ç‰¹æ€§	C int	Python int
# ç±»åž‹	åŽŸå§‹ç±»åž‹	å¯¹è±¡
# å­˜å‚¨ä½ç½®	æ ˆ	å †
# å ç”¨å†…å­˜	é€šå¸¸ 4 å­—èŠ‚	é€šå¸¸ â‰¥ 28 å­—èŠ‚
# åŒ…å«å†…å®¹	ä»…å€¼	å¼•ç”¨è®¡æ•°ã€ç±»åž‹ä¿¡æ¯ã€å€¼
# æ€§èƒ½	é«˜æ•ˆ	ç›¸å¯¹è¾ƒæ…¢

# ðŸ§© 1. é“¾å¼èµ‹å€¼ï¼ˆChained Assignmentï¼‰
# ä½ å¯ä»¥ä¸€æ¬¡æ€§ç»™å¤šä¸ªå˜é‡èµ‹ç›¸åŒçš„å€¼ï¼š
a = b = c = 0
print(a, b, c)  # è¾“å‡ºï¼š0 0 0
# ðŸŒŸ 2. æ˜Ÿå·è§£åŒ…ï¼ˆStarred Unpackingï¼‰
# æ˜Ÿå· * å¯ä»¥ç”¨æ¥â€œæ‰“åŒ…â€æˆ–â€œè§£åŒ…â€å¤šä¸ªå€¼ï¼Œå¸¸ç”¨äºŽä¸å®šæ•°é‡çš„å…ƒç´ ã€‚
#
# âœ… ç”¨åœ¨èµ‹å€¼ä¸­ï¼š
# âš ï¸ æ³¨æ„ï¼š
# æ˜Ÿå·åªèƒ½ç”¨åœ¨ä¸€ä¸ªå˜é‡ä¸Šï¼ˆå¦åˆ™ Python ä¸çŸ¥é“æ€Žä¹ˆåˆ†é…ï¼‰
# è§£åŒ…çš„ç›®æ ‡å˜é‡æ•°é‡å¿…é¡»å’Œå…ƒç´ æ•°é‡åŒ¹é…ï¼ˆé™¤éžç”¨äº†æ˜Ÿå·ï¼‰
a, *b, c = [1, 2, 3, 4, 5]
print(a)  # 1
print(b)  # [2, 3, 4]
print(c)  # 5
*a, b, c = [1, 2, 3, 4, 5]
# a = [1, 2, 3], b = 4, c = 5

a, b, *c = [1, 2, 3, 4, 5]
# a = 1, b = 2, c = [3, 4, 5]


def add(x, y, z):
    return x + y + z


nums = [1, 2, 3]
print(add(*nums))  # è§£åŒ…åˆ—è¡¨ä¸ºå‚æ•°

# ðŸ”„ 3. äº¤æ¢å˜é‡ï¼ˆSwap Variablesï¼‰
# Python æ”¯æŒéžå¸¸ç®€æ´çš„å˜é‡äº¤æ¢æ–¹å¼ï¼šå¿«é€Ÿäº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼è€Œä¸ç”¨é‡æ–°declare æ–°çš„å˜é‡
a = 5
b = 10
a, b = b, a
print(a, b)  # è¾“å‡ºï¼š10 5

# # Walrus è¿ç®—ç¬¦ :=
# ðŸ§  åŸºæœ¬æ¦‚å¿µï¼šä¸ºä»€ä¹ˆå¼•å…¥ :=
# åœ¨ Python 3.8 ä¹‹å‰ï¼Œä½ å¿…é¡»æŠŠâ€œèµ‹å€¼â€å’Œâ€œåˆ¤æ–­â€åˆ†å¼€ï¼š
line = input("Enter: ")
while line != "":
    print(f"You typed: {line}")
    line = input("Enter again: ")
# è¿™å¾ˆå†—é•¿ â€”â€” æ˜Žæ˜Žå·²ç»æœ‰äº† input()ï¼Œå´å¾—è°ƒç”¨ä¸¤æ¬¡ã€‚
#
# ä½¿ç”¨ Walrus è¿ç®—ç¬¦ï¼Œä½ å¯ä»¥åœ¨è¡¨è¾¾å¼å†…éƒ¨ç›´æŽ¥èµ‹å€¼ï¼š
while (line := input("Enter: ")) != "":
    print(f"You typed: {line}")

# âœ… Walrus å†™æ³•ï¼šè¾¹èµ‹å€¼è¾¹åˆ¤æ–­
if (n := len("hello world")) > 5:
    print(f"String is long (length: {n})")
# è¿™ä¸ªå†™æ³•çš„ ä¼˜åŠ¿åœ¨äºŽï¼š
#
# ä½ åœ¨ if é‡Œå°±é¡ºä¾¿æ‹¿åˆ°äº† n çš„å€¼ï¼Œä¸ç”¨æå‰å£°æ˜Žã€‚
#
# æ¯”æ™®é€šèµ‹å€¼+åˆ¤æ–­å†™æ³•æ›´ç´§å‡‘ã€‚
#
# å¦‚æžœ n åŽé¢è¿˜è¦ç”¨åˆ°ï¼Œä¸ç”¨å†è®¡ç®—ä¸€æ¬¡ã€‚

# ä¸æŽ¨èä½¿ç”¨åœºæ™¯ï¼š
# ðŸš« å¦‚æžœè¿™ä¸ªå€¼åªç”¨ä¸€æ¬¡ï¼Œæˆ–è€…ä½ å¸Œæœ›ä»£ç æ›´æ¸…æ™°ã€ä¾¿äºŽé˜…è¯»ï¼š
data = 10
if len(data) > 100:  # ç›´æŽ¥å†™å°±å¥½
    print(f"String is long (length: {len(data)})")
